<div>
  <form id="subscribe-form">
    <div class="mx-auto flex max-w-sm items-center p-1 pr-0">
      <input
        type="email"
        id="email"
        placeholder="yourmail@example.com"
        class="text-grey-dark mr-2 flex-1 appearance-none rounded p-2 shadow focus:outline-none"
      />
      <button
        type="submit"
        class="rounded-md bg-slate-600 p-2 text-base font-semibold text-white shadow-md hover:bg-indigo-600"
        >Subscribe</button
      >
    </div>
  </form>
</div>

<style></style>
<script is:inline>
  console.log(import.meta.env.SENDGRID_API_KEY);

  document
    .getElementById("subscribe-form")
    .addEventListener("submit", async (e) => {
      e.preventDefault();

      const email = document.getElementById("email").value;

      if (email) {
        try {
          const response = await addContactToSendGrid(email);

          if (response.status === 202) {
            alert("Successfully subscribed!");
          } else {
            alert("Failed to subscribe. Please try again.");
          }
        } catch (error) {
          console.error("Error:", error);
          alert("An error occurred. Please try again later.");
        }
      }
    });

  async function addContactToSendGrid(email) {
    const apiKey = import.meta.env.SENDGRID_API_KEY;
    const url = "https://api.sendgrid.com/v3/marketing/contacts";

    console.log(url, apiKey);
    const data = {
      contacts: [{ email: email }],
    };

    const response = await fetch(url, {
      method: "PUT",
      headers: {
        "Content-Type": "application/json",
        Authorization: `Bearer ${apiKey}`,
      },
      body: JSON.stringify(data),
    });

    return response;
  }
</script>
